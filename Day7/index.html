<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Looops</title>
</head>

<body>


<script src="index.js"></script>
<script>

var dirs = [[0, 1], [0, -1], [1, 0], [-1, 0]]
function randomDirection() {
  return dirs[Math.floor(Math.random() * 4)]
}


function makeLoop(minLength, maxLength) {
  var pt = [0, 0]
  var deltas = []
  while (deltas.length < minLength || pt[0] != 0 || pt[1] != 0) {
    if (deltas.length >= maxLength) {
      return makeLoop(minLength, maxLength)
    }
    var dir = randomDirection()
    pt = [pt[0] + dir[0], pt[1] + dir[1]]
    deltas.push(dir)
  }
  return deltas
}





var app = Elm.Loops.fullscreen()

app.ports.requestLoops.subscribe(function(args) {
  var width = args[0], height = args[1], minLength = args[2], maxLength = args[3], count = args[4]
  var loops = []

  for (var i = 0; i < count; i++) {
    deltas = makeLoop(minLength, maxLength)
    center = [Math.random() * width | 0, Math.random() * height | 0]
    // center = [width / 2 | 0, height / 2 | 0]
    hue = Math.random() * 360

    loops.push([deltas, center, hue])
  }

  app.ports.getLoops.send(loops)
})


</script>



</body>


</html>
