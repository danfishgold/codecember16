<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Looops</title>
  </head>

  <body>
    <script src="elm.js"></script>
    <script>
      var dirs = [[0, 1], [0, -1], [1, 0], [-1, 0]];
      function randomDirection() {
        return dirs[Math.floor(Math.random() * 4)];
      }

      function makeLoop(minLength, maxLength) {
        var pt = [0, 0];
        var deltas = [];
        while (deltas.length < minLength || pt[0] != 0 || pt[1] != 0) {
          if (deltas.length >= maxLength) {
            return makeLoop(minLength, maxLength);
          }
          var dir = randomDirection();
          pt = [pt[0] + dir[0], pt[1] + dir[1]];
          deltas.push(dir);
        }
        return deltas;
      }

      var app = Elm.Main.init();

      app.ports.requestLoops.subscribe(function(args) {
        var loops = [];

        for (var i = 0; i < args.count; i++) {
          deltas = makeLoop(args.minLength, args.maxLength);
          center = [
            (Math.random() * args.width) | 0,
            (Math.random() * args.height) | 0
          ];
          // center = [args.width / 2 | 0, args.height / 2 | 0]
          hue = Math.random() * 360;

          loops.push([deltas, center, hue]);
        }

        app.ports.getLoops.send(loops);
      });
    </script>
  </body>
</html>
